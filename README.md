# Analyzing Malware
    Analysis of the Zeus Banking Trojan

<h2>üë©üèª‚ÄçüíªProject Context</h2>

This project is separated into two parts, the first part of the project we created two virtual machines and a host-only network between the VMs. If you are unaware of what I am referring to, see the first part of the project [here](https://github.com/gaelrivera123/MalwareAnalysisLab/tree/main). When it comes to malware analysis, security practictioners may either used self-hosted labs or cloud-hosted labs, however, in this specific project we will be using self-hosted labs to analyze our sample malware. During this portion of the project, we will utilize popular malware analysis tools and techniques in order to gain further understanding of our malware sample.

<h2>üëæHistory of Zeus Banking Trojan</h2>

- <b>Initially created to extract financial information</b>
- <b>First identified in 2007</b>
  - Since its identification in 2007, there are over 578+ versions of the malware and 36 families
- <b>Code became leaked in 2011 which sparked new versions of the malware but also led to further information on the suspected author, Evgeniy
Mikhailovich Bogachev. He currently has a bounty of $3 million on him set by the FBI</b>
- <b>Methods of Delivery</b>
  - Drive-by downloads: Requires user to visit a site and unsuspectingly download the trojan. Mostly obselete since most websites block malicious downloads by default.
  - Phishing: Social Engineering Method which imitates a legimitate source and preys on unsuspecting users. Main method.
- <b>Trojan's Intentions</b>
  - Steal financial information
  - Add infected machines to a botnet
    - A botnet is a collection of infected machines which are used for mass-attacks, such as spam emails, phishing, DDoS attacks etc.
- <b>Impact</b>
  - Inspired hundreds of variants which utilize leaked source code
  - Led to infection of millions of computers
  - Over $100 million in damages

<h2>‚úÖProject Prerequisites</h2>

  - <b>Self-hosted lab</b>
    - Cloud-hosted works, but steps may be slightly different
  - <b>Snapshot of base image</b>
  - <b>Internet Connection</b>

<h2>üõ†Ô∏èMalware Analysis Tools Overview</h2>

<h3>Static Tools</h3>

- <b>VirusTotal</b>
  - Analysis tool which reviews malicious files, domains, IPs, and URLs to detect malware
  - Collects results of antivirus services and online security engines which have flagged the malicious file as being a threat.
  - Used to measure its functionality against established security engines.

- <b>PeStudio</b>
  - Statically analyzes sample malware and identifies artifacts of interest</b>
  - Collects metadata:
    - Hashes
    - Header
    - Properties
    - Libraries Used
    - Imports
    - Strings

- <b>Floss</b>
  - Extracts strings from executables
  - Uses advanced static analysis technique to make strings from malware binaries much easier to understand (deobsfucation)

- <b>Capa</b>
  - Detects capabilities of program and outputs what it thinks it may accomplish
  - Rules matched against previously known API calls, strings of interest etc.
  - Behavior mapped to MITRE ATT&CK framework
    - MITRE ATT&CK framework is a guideline for classifying and describing cyberattacks. Essentially the knowledge and base model for cyber adversary behavior.

- <b>Cutter</b>
  - Reverse-Engineering platform
    - Reverse-Engineering refers to the process of deconstruction of a program to better understand its functionalities
  - Used to view assembly-level instructions of a program
    - Assembly language is a low-level programming "language" intended to communicate directly with a computer's hardware. Can reveal how sample malware directly communicates with a computer.
  - View decompiled code
 
<h3>Dynamic Tools</h3>

- <b>INetSim</b>
  - Used to simulate common internet services
  - Used to analyze network behavior changes caused by sample malware

- <b>Wireshark</b>
  - Network packet sniffer and analyzer. Used for troubleshooting a network and analyzing its packets
  - In malware analysis, it can:
    - View ingoing/outgoing network traffic from malicious programs
    - Flag domains or IPs that are being reached out to from the malicious program
   
- <b>Process Monitor (Procmon)</b>
  - Monitors and displays real-time info on Windows filesystem,
  - Captures events from 5 different categories
    - Registry
    - Filesystem
    - Network
    - Processes
    - Profiling Events
  - Used to view malicious changed to filesystem

<h3>Other tools</h3>
 
 - <b>YARA</b>
   - Helps classify and identify malware samples by grouping it with malware families based on textual or binary patterns
   - Can help better identify malicious files since it focuses on finding malware families associated with the sample malware
   - Exploits code similarities between malware samples within a family
  
<h2>ü™úCommon Stages of Malware Analysis</h2>

<b>Static Properties Analysis</b>
- This stage of analysis utilizes the technique of static analysis, which is analyzing malicous files metadata and other information without the need to execute the malware.

<b>Interactive Behavior Analysis</b>
- Here, the technique known as dynamic analysis is used, which involves detonating the malware in a lab to analyze its behavior in real-time.

<b>Fully Automated Analysis</b>
- Malicious files are scanned utilizing automated tools, which in turn can allow you to better understand the sample malware and potential damages it may have to other assets connected to your network.

<b>Reverse-Engineering</b>
- Deconstructing the code after the malicious software has been deployed is highly effective in helping a cybersecurity practioner better understand the effects of malware after it has been fully deployed.

<b>Documenting your Findings</b>
- It is crucial to document your findings of the sample malware, so that in the future you have a greater understanding of how to potentially avoid being infected by malware, and what tactics you may utilize in the event you are infected.

<h2>‚ö†Ô∏èFinal Warnings and Disclaimer:</h2>

- <b>Safety is a requirement when it comes to dealing with malware samples. Always ensure you are following the correct procedures so that you do not risk infecting your host machine. Follow all instructions as stated and remember to use personal judgement when it comes to malware. 
- <b>Disclaimers
  - The project is intended for educational purposes only. I do not condone the use of malware to harm individuals or organizations.
  - I take no responsibility for the infection of malicious software, programs, or files onto any computer or system.

<h2>üö∂Full Project Walkthrough</h2>

1. Navigate to VirtualBox and open FlareVM and REMnux.
2. Briefly connect to an internet connection on FlareVM, use NAT or Bridged Adapter
- FlareVM -> Machine -> Settings -> Network -> Attached to: -> NAT or Bridge Adapter -> OK
3. On FlareVM, navigate to Microsoft edge and then proceed to this [website](https://github.com/ytisf/theZoo/tree/master/malware/Binaries/ZeusBankingVersion_26Nov2013)
- Download the ZeusBankingVersion_26Nov2013.zip file, and drag it to your desktop.
- Immediately after download, reconnect to Host-only Adapter to cut off internet access.
4. Before extracting the .exe file from the zip, ensure you are on a host-machine, with no internet access, and are following all safety protocols. Once safety protocols are ensured, you may now:
- Right-click the .zip file -> 7-zip -> Open Archive -> Drag and Drop invoice file -> enter password (infected)
5. We will be building a report as we analyze the sample malware. On your host machine, feel free to use any document editor of your choose and structure it as recommended here:
![image](https://i.gyazo.com/42b92d2114502a6e83e9bcbd3adcf045.png)


